<!doctype html>\n<html lang="en" data-bs-theme="light">\n

<head>\n
    <meta charset="utf-8">\n
    <meta name="viewport" content="width=device-width, initial-scale=1">\n <title>OpenNourish</title>\n
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">\n
    <link href="/static/bootstrap.min.css" rel="stylesheet">\n
    <link rel="stylesheet" href="/static/style.css">\n
    <script src="/static/chart.js"></script>\n
</head>\n

<body>\n <nav class="navbar navbar-expand-lg bg-dark navbar-dark">\n <div class="container-fluid">\n <a
                class="navbar-brand" href="/dashboard/"><img src="/static/icon.png" width="30" height="30"
                    class="d-inline-block align-top" alt="OpenNourish Logo"> <span
                    class="d-none d-sm-inline">OpenNourish</span></a>\n <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#primaryNavbar" aria-controls="primaryNavbar"
                aria-expanded="false" aria-label="Toggle navigation">\n <span class="navbar-toggler-icon"></span>\n
            </button>\n <div class="collapse navbar-collapse" id="primaryNavbar">\n <ul
                    class="navbar-nav me-auto mb-2 mb-lg-0">\n \n <li class="nav-item">\n <a class="nav-link " \n
                            href="/dashboard/">Dashboard</a>\n </li>\n\n
                    <!-- Food Nav: Link for Desktop, Dropdown for Mobile -->\n <li class="nav-item d-none d-lg-block">\n
                        <a class="nav-link active" \n href="/diary/">Food</a>\n </li>\n <li
                        class="nav-item dropdown d-lg-none">\n <a class="nav-link dropdown-toggle active" href="#"
                            id="foodDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n Food\n
                        </a>\n <ul class="dropdown-menu" aria-labelledby="foodDropdown">\n <li><a
                                    class="dropdown-item active" href="/diary/">Food Diary</a></li>\n <li><a
                                    class="dropdown-item " href="/my_foods/">My Foods</a></li>\n <li><a
                                    class="dropdown-item " href="/my_meals">My Meals</a></li>\n <li><a
                                    class="dropdown-item " href="/recipes/">My Recipes</a></li>\n <li><a
                                    class="dropdown-item " href="/search/?search_mode=usda_only">Search USDA</a></li>\n
                        </ul>\n </li>\n\n <!-- Body Nav: Link for Desktop, Dropdown for Mobile -->\n <li
                        class="nav-item d-none d-lg-block">\n <a class="nav-link " href="/exercise/log">Body</a>\n </li>
                    \n <li class="nav-item dropdown d-lg-none">\n <a class="nav-link dropdown-toggle " href="#"
                            id="bodyDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n Body\n
                        </a>\n <ul class="dropdown-menu" aria-labelledby="bodyDropdown">\n <li><a class="dropdown-item "
                                    href="/exercise/log">Exercise Log</a></li>\n <li><a class="dropdown-item "
                                    href="/tracking/progress">Check-in & Progress</a></li>\n <li><a
                                    class="dropdown-item " href="/fasting/">Fasting</a></li>\n </ul>\n </li>\n\n <li
                        class="nav-item">\n <a class="nav-link " href="/friends/">Friends</a>\n </li>\n\n
                    <!-- Admin Nav: Link for Desktop, Dropdown for Mobile -->\n \n </ul>\n <ul class="navbar-nav">\n \n
                    <li class="nav-item dropdown">\n <a class="nav-link dropdown-toggle" href="#"
                            id="navbarUserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n
                            testuser\n </a>\n <ul class="dropdown-menu dropdown-menu-end"
                            aria-labelledby="navbarUserDropdown">\n <li><a class="dropdown-item"
                                    href="/goals/">Goals</a></li>\n <li><a class="dropdown-item"
                                    href="/settings/">Settings</a></li>\n \n <li>
                                <hr class="dropdown-divider">
                            </li>\n <li><a class="dropdown-item" href="/auth/logout">Logout</a></li>\n </ul>\n </li>\n
                    \n </ul>\n </div>\n </div>\n</nav>
    \n\n<!-- Secondary Navigation Bar (Hidden on smaller screens) -->\n<nav
        class="navbar navbar-light bg-light border-bottom mb-4 d-none d-lg-block">\n <div class="container">\n <ul
                class="navbar-nav flex-row flex-wrap justify-content-center">\n \n \n <li class="nav-item">\n <a
                        class="nav-link px-2 active" href="/diary/">Food Diary</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/my_foods/">My Foods</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/my_meals">My Meals</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/recipes/">My Recipes</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/search/?search_mode=usda_only">Search USDA</a>\n </li>\n \n\n \n
                \n\n \n \n </ul>\n </div>\n</nav>\n\n <div class="container">\n \n \n \n \n<div class="container">\n \n
            <div class="d-sm-flex justify-content-between align-items-center mb-3 mt-4">\n <div
                    class="d-flex justify-content-between mb-2 mb-sm-0">\n \n <a href="/diary/2025-07-31"
                        class="btn btn-outline-secondary me-2">&laquo; Prev Day</a>\n \n \n <a href="/diary/2025-08-02"
                        class="btn btn-outline-secondary">Next Day &raquo;</a>\n \n </div>\n <h1
                    class="mb-0 text-center">Food Diary</h1>\n <h2 class="mb-0 text-center h4">Friday, August 01, 2025
                </h2>\n</div>\n\n <div class="card mb-4">\n <div class="card-header">\n <h3>Daily Nutrition Summary</h3>
                    \n </div>\n <div class="card-body">\n <div class="row">\n <div class="col-lg-12">\n <h5
                                class="mb-1">Calories Progress</h5>\n <small class="text-muted d-block mb-1">\n Goal:
                                2000.0 kcal | Consumed: 0.0 kcal | Burned: 0.0 kcal\n </small>\n <p class="mb-2">\n
                                Remaining: 2000.0 kcal\n </p>\n <div class="progress" style="height: 15px;">\n \n\n \n\n
                                <div class="progress-bar bg-success" role="progressbar" style="width: 0.0%;"
                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="2000">\n\n 0.0%\n\n </div>\n
                            </div>\n </div>\n </div>\n <div class="row mt-3">\n \n \n <div class="col-lg-4 mb-3">\n <h5
                                class="mb-1">Protein Progress</h5>\n <small class="text-muted d-block mb-1">\n Goal:
                                150.0g | Consumed: 0.0g\n </small>\n <div class="progress" style="height: 15px;">\n \n
                                <div class="progress-bar bg-success" role="progressbar" style="width: 0.0%;"
                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="150">\n 0.0%\n </div>\n </div>\n
                        </div>\n \n <div class="col-lg-4 mb-3">\n <h5 class="mb-1">Carbohydrates Progress</h5>\n <small
                                class="text-muted d-block mb-1">\n Goal: 250.0g | Consumed: 0.0g\n </small>\n <div
                                class="progress" style="height: 15px;">\n \n <div class="progress-bar bg-success"
                                    role="progressbar" style="width: 0.0%;" aria-valuenow="0" aria-valuemin="0"
                                    aria-valuemax="250">\n 0.0%\n </div>\n </div>\n </div>\n \n <div
                            class="col-lg-4 mb-3">\n <h5 class="mb-1">Fat Progress</h5>\n <small
                                class="text-muted d-block mb-1">\n Goal: 60.0g | Consumed: 0.0g\n </small>\n <div
                                class="progress" style="height: 15px;">\n \n <div class="progress-bar bg-success"
                                    role="progressbar" style="width: 0.0%;" aria-valuenow="0" aria-valuemin="0"
                                    aria-valuemax="60">\n 0.0%\n </div>\n </div>\n </div>\n \n </div>\n </div>\n \n \n
                \n <div class="card mb-3">\n <div
                        class="card-header d-flex flex-column flex-md-row justify-content-md-between align-items-md-center">
                        \n <h4 class="mb-2 mb-md-0">\n Breakfast\n \n </h4>\n \n <div
                            class="d-flex flex-column flex-md-row align-items-md-center">\n \n <form
                                action="/diary/save_meal" method="post" class="d-flex me-md-2 mb-2 mb-md-0">\n <input
                                    type="hidden" name="log_date" value="2025-08-01">\n <input type="hidden"
                                    name="meal_name" value="Breakfast">\n <input type="text" name="new_meal_name"
                                    class="form-control form-control-sm me-2" placeholder="Save as new meal...">\n
                                <button type="submit" class="btn btn-outline-success btn-sm">Save</button>\n </form>\n
                            <div class="d-flex">\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Breakfast"
                                    class="btn btn-outline-primary btn-sm">\n <span class="d-none d-md-inline">Add
                                        Food</span>\n <span class="d-inline d-md-none">Add</span>\n </a>\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Breakfast&amp;scan=true"
                                    class="btn btn-outline-info btn-sm ms-2">\n <span class="d-none d-md-inline">Scan
                                        Barcode</span>\n <span class="d-inline d-md-none">Scan</span>\n </a>\n </div>\n
                            \n </div>\n \n </div>\n <ul class="list-group list-group-flush">\n \n <li
                            class="list-group-item">No items logged for this meal.</li>\n \n </ul>\n </div>\n \n \n <div
                    class="card mb-3">\n <div
                        class="card-header d-flex flex-column flex-md-row justify-content-md-between align-items-md-center">
                        \n <h4 class="mb-2 mb-md-0">\n Lunch\n \n </h4>\n \n <div
                            class="d-flex flex-column flex-md-row align-items-md-center">\n \n <form
                                action="/diary/save_meal" method="post" class="d-flex me-md-2 mb-2 mb-md-0">\n <input
                                    type="hidden" name="log_date" value="2025-08-01">\n <input type="hidden"
                                    name="meal_name" value="Lunch">\n <input type="text" name="new_meal_name"
                                    class="form-control form-control-sm me-2" placeholder="Save as new meal...">\n
                                <button type="submit" class="btn btn-outline-success btn-sm">Save</button>\n </form>\n
                            <div class="d-flex">\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Lunch"
                                    class="btn btn-outline-primary btn-sm">\n <span class="d-none d-md-inline">Add
                                        Food</span>\n <span class="d-inline d-md-none">Add</span>\n </a>\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Lunch&amp;scan=true"
                                    class="btn btn-outline-info btn-sm ms-2">\n <span class="d-none d-md-inline">Scan
                                        Barcode</span>\n <span class="d-inline d-md-none">Scan</span>\n </a>\n </div>\n
                            \n </div>\n \n </div>\n <ul class="list-group list-group-flush">\n \n <li
                            class="list-group-item">No items logged for this meal.</li>\n \n </ul>\n </div>\n \n \n <div
                    class="card mb-3">\n <div
                        class="card-header d-flex flex-column flex-md-row justify-content-md-between align-items-md-center">
                        \n <h4 class="mb-2 mb-md-0">\n Dinner\n \n </h4>\n \n <div
                            class="d-flex flex-column flex-md-row align-items-md-center">\n \n <form
                                action="/diary/save_meal" method="post" class="d-flex me-md-2 mb-2 mb-md-0">\n <input
                                    type="hidden" name="log_date" value="2025-08-01">\n <input type="hidden"
                                    name="meal_name" value="Dinner">\n <input type="text" name="new_meal_name"
                                    class="form-control form-control-sm me-2" placeholder="Save as new meal...">\n
                                <button type="submit" class="btn btn-outline-success btn-sm">Save</button>\n </form>\n
                            <div class="d-flex">\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Dinner"
                                    class="btn btn-outline-primary btn-sm">\n <span class="d-none d-md-inline">Add
                                        Food</span>\n <span class="d-inline d-md-none">Add</span>\n </a>\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Dinner&amp;scan=true"
                                    class="btn btn-outline-info btn-sm ms-2">\n <span class="d-none d-md-inline">Scan
                                        Barcode</span>\n <span class="d-inline d-md-none">Scan</span>\n </a>\n </div>\n
                            \n </div>\n \n </div>\n <ul class="list-group list-group-flush">\n \n <li
                            class="list-group-item">No items logged for this meal.</li>\n \n </ul>\n </div>\n \n</div>
            \n\n </div>\n\n <!-- Add to Diary Modal -->\n <div class="modal fade" id="addToDiaryModal" tabindex="-1"
            aria-labelledby="addToDiaryModalLabel" aria-hidden="true">\n <div class="modal-dialog">\n <div
                    class="modal-content">\n <div class="modal-header">\n <h5 class="modal-title"
                            id="addToDiaryModalLabel">Add to Diary</h5>\n <button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button>\n </div>\n <form id="addToDiaryForm"
                        action="/search/add_item" method="post">\n <div class="modal-body">\n <p>Adding: <strong
                                    id="modalFoodName"></strong></p>\n <input type="hidden" name="food_id"
                                id="modalFoodId">\n <input type="hidden" name="food_type" id="modalFoodType">\n <input
                                type="hidden" name="target" value="diary">\n\n <div class="mb-3">\n <label
                                    for="modalLogDate" class="form-label">Date</label>\n <input type="date"
                                    class="form-control" id="modalLogDate" name="log_date" required>\n </div>\n\n <div
                                class="mb-3">\n <label for="modalMealName" class="form-label">Meal</label>\n <select
                                    class="form-select" id="modalMealName" name="meal_name" required>\n
                                    <!-- Options will be populated by JavaScript -->\n </select>\n </div>\n\n <div
                                id="modalAmountPortionFields">\n <div class="row">\n <div class="col">\n <div
                                            class="mb-3">\n <label for="modalAmount"
                                                class="form-label">Quantity</label>\n <input type="number" step="0.01"
                                                class="form-control" id="modalAmount" name="amount" value="1"
                                                required>\n </div>\n </div>\n <div class="col">\n <div class="mb-3">\n
                                            <label for="modalPortionId" class="form-label">Portion</label>\n <select
                                                class="form-select" id="modalPortionId" name="portion_id" required>\n
                                                <!-- Options will be populated by JavaScript -->\n </select>\n </div>\n
                                    </div>\n </div>\n </div>\n\n </div>\n <div class="modal-footer">\n <button
                                type="button" class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">Cancel</button>\n <button type="submit"
                                class="btn btn-outline-primary">Confirm Add</button>\n </div>\n </form>\n </div>\n
            </div>\n </div>\n\n
        <script src="/static/bootstrap.bundle.min.js"></script>\n \n
        <script>\n        document.addEventListener(\'DOMContentLoaded\', function() {\n            const addToDiaryModal = new bootstrap.Modal(document.getElementById(\'addToDiaryModal\'));\n            const addToDiaryForm = document.getElementById(\'addToDiaryForm\');\n            const modalFoodName = document.getElementById(\'modalFoodName\');\n            const modalFoodId = document.getElementById(\'modalFoodId\');\n            const modalFoodType = document.getElementById(\'modalFoodType\');\n            const modalLogDate = document.getElementById(\'modalLogDate\');\n            const modalMealName = document.getElementById(\'modalMealName\');\n            const modalPortionId = document.getElementById(\'modalPortionId\');\n            const modalAmountPortionFields = document.getElementById(\'modalAmountPortionFields\');\n\n            document.querySelectorAll(\'.add-to-diary-btn\').forEach(button => {\n                button.addEventListener(\'click\', function() {\n                    const foodId = this.dataset.foodId;\n                    const foodType = this.dataset.foodType;\n                    const foodName = this.dataset.foodName;\n\n                    // 1. Populate static fields\n                    modalFoodName.textContent = foodName;\n                    modalFoodId.value = foodId;\n                    modalFoodType.value = foodType;\n\n                    // 2. Set date to today\n                    modalLogDate.value = new Date().toISOString().split(\'T\')[0];\n\n                    // 3. Build meal dropdown\n                    modalMealName.innerHTML = \'\';\n                    const mealsPerDay = 3;\n                    const standardMealNames = ["Breakfast", "Snack (morning)", "Lunch", "Snack (afternoon)", "Dinner", "Snack (evening)"];\n                    for (let i = 0; i < mealsPerDay; i++) {\n                        const option = document.createElement(\'option\');\n                        option.value = standardMealNames[i];\n                        option.textContent = standardMealNames[i];\n                        modalMealName.appendChild(option);\n                    }\n\n                    // 4. Show/hide amount/portion fields based on food type\n                    if (foodType === \'my_meal\') {\n                        modalAmountPortionFields.style.display = \'none\';\n                    } else {\n                        modalAmountPortionFields.style.display = \'block\';\n                    }\n\n                    // 5. Fetch portions\n                    modalPortionId.innerHTML = \'<option>Loading...</option>\';\n                    fetch(`/search/api/get-portions/${foodType}/${foodId}`)\n                        .then(response => response.json())\n                        .then(data => {\n                            modalPortionId.innerHTML = \'\';\n                            if (data.error) {\n                                const option = document.createElement(\'option\');\n                                option.textContent = \'Error loading portions\';\n                                modalPortionId.appendChild(option);\n                                console.error(\'Error fetching portions:\', data.error);\n                                return;\n                            }\n                            data.forEach(portion => {\n                                const option = document.createElement(\'option\');\n                                option.value = portion.id;\n                                option.textContent = portion.description;\n                                modalPortionId.appendChild(option);\n                            });\n                        })\n                        .catch(error => {\n                            modalPortionId.innerHTML = \'\';\n                            const option = document.createElement(\'option\');\n                            option.textContent = \'Error loading portions\';\n                            modalPortionId.appendChild(option);\n                            console.error(\'Error fetching portions:\', error);\n                        });\n\n                    // 6. Show modal\n                    addToDiaryModal.show();\n                });\n            });\n\n            // Handle form submission with Fetch API to stay on the same page\n            addToDiaryForm.addEventListener(\'submit\', function(event) {\n                event.preventDefault(); // Stop default form submission\n\n                const formData = new FormData(this);\n                \n                fetch(this.action, {\n                    method: \'POST\',\n                    body: formData\n                })\n                .then(response => {\n                    // Check for redirect, which indicates success in the add_item endpoint\n                    if (response.redirected) {\n                        // Manually follow the redirect to get the flash messages\n                        return fetch(response.url);\n                    }\n                    // If no redirect, something might have gone wrong, or it was an API response\n                    return response.text();\n                })\n                .then(html => {\n                    // The response from the followed redirect will contain the new page with the flash message.\n                    // We can just reload the current page, and the flash message from the server session will be displayed.\n                    window.location.reload();\n                })\n                .catch(error => {\n                    console.error(\'Error submitting form:\', error);\n                    // Optionally, display an error message in the modal\n                });\n\n                addToDiaryModal.hide();\n            });\n\n            const htmlTag = document.documentElement;\n            const userThemePreference = htmlTag.getAttribute(\'data-bs-theme\');\n\n            if (userThemePreference === \'auto\') {\n                const prefersDarkMode = window.matchMedia(\'(prefers-color-scheme: dark)\').matches;\n                if (prefersDarkMode) {\n                    htmlTag.setAttribute(\'data-bs-theme\', \'dark\');\n                } else {\n                    htmlTag.setAttribute(\'data-bs-theme\', \'light\');\n                }\n            }\n        });\n    </script>
        \n \n
        <script>\n        document.addEventListener(\'DOMContentLoaded\', function() {\n            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n            if (userTimezone) {\n                fetch("/settings/set-timezone", {\n                    method: \'POST\',\n                    headers: {\n                        \'Content-Type\': \'application/json\',\n                    },\n                    body: JSON.stringify({ timezone: userTimezone }),\n                })\n                .then(response => response.json())\n                .then(data => {\n                    if (data.status === \'success\') {\n                        console.log(\'Timezone set to:\', userTimezone);\n                        // Optionally, reload the page to apply the new timezone immediately\n                        // window.location.reload();\n                    }\n                })\n                .catch((error) => {\n                    console.error(\'Error setting timezone:\', error);\n                });\n            }\n        });\n    </script>
        \n \n </body>\n

</html>'
+ where b'
<!doctype html>\n<html lang="en" data-bs-theme="light">\n

<head>\n
    <meta charset="utf-8">\n
    <meta name="viewport" content="width=device-width, initial-scale=1">\n <title>OpenNourish</title>\n
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">\n
    <link href="/static/bootstrap.min.css" rel="stylesheet">\n
    <link rel="stylesheet" href="/static/style.css">\n
    <script src="/static/chart.js"></script>\n
</head>\n

<body>\n <nav class="navbar navbar-expand-lg bg-dark navbar-dark">\n <div class="container-fluid">\n <a
                class="navbar-brand" href="/dashboard/"><img src="/static/icon.png" width="30" height="30"
                    class="d-inline-block align-top" alt="OpenNourish Logo"> <span
                    class="d-none d-sm-inline">OpenNourish</span></a>\n <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#primaryNavbar" aria-controls="primaryNavbar"
                aria-expanded="false" aria-label="Toggle navigation">\n <span class="navbar-toggler-icon"></span>\n
            </button>\n <div class="collapse navbar-collapse" id="primaryNavbar">\n <ul
                    class="navbar-nav me-auto mb-2 mb-lg-0">\n \n <li class="nav-item">\n <a class="nav-link " \n
                            href="/dashboard/">Dashboard</a>\n </li>\n\n
                    <!-- Food Nav: Link for Desktop, Dropdown for Mobile -->\n <li class="nav-item d-none d-lg-block">\n
                        <a class="nav-link active" \n href="/diary/">Food</a>\n </li>\n <li
                        class="nav-item dropdown d-lg-none">\n <a class="nav-link dropdown-toggle active" href="#"
                            id="foodDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n Food\n
                        </a>\n <ul class="dropdown-menu" aria-labelledby="foodDropdown">\n <li><a
                                    class="dropdown-item active" href="/diary/">Food Diary</a></li>\n <li><a
                                    class="dropdown-item " href="/my_foods/">My Foods</a></li>\n <li><a
                                    class="dropdown-item " href="/my_meals">My Meals</a></li>\n <li><a
                                    class="dropdown-item " href="/recipes/">My Recipes</a></li>\n <li><a
                                    class="dropdown-item " href="/search/?search_mode=usda_only">Search USDA</a></li>\n
                        </ul>\n </li>\n\n <!-- Body Nav: Link for Desktop, Dropdown for Mobile -->\n <li
                        class="nav-item d-none d-lg-block">\n <a class="nav-link " href="/exercise/log">Body</a>\n </li>
                    \n <li class="nav-item dropdown d-lg-none">\n <a class="nav-link dropdown-toggle " href="#"
                            id="bodyDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n Body\n
                        </a>\n <ul class="dropdown-menu" aria-labelledby="bodyDropdown">\n <li><a class="dropdown-item "
                                    href="/exercise/log">Exercise Log</a></li>\n <li><a class="dropdown-item "
                                    href="/tracking/progress">Check-in & Progress</a></li>\n <li><a
                                    class="dropdown-item " href="/fasting/">Fasting</a></li>\n </ul>\n </li>\n\n <li
                        class="nav-item">\n <a class="nav-link " href="/friends/">Friends</a>\n </li>\n\n
                    <!-- Admin Nav: Link for Desktop, Dropdown for Mobile -->\n \n </ul>\n <ul class="navbar-nav">\n \n
                    <li class="nav-item dropdown">\n <a class="nav-link dropdown-toggle" href="#"
                            id="navbarUserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n
                            testuser\n </a>\n <ul class="dropdown-menu dropdown-menu-end"
                            aria-labelledby="navbarUserDropdown">\n <li><a class="dropdown-item"
                                    href="/goals/">Goals</a></li>\n <li><a class="dropdown-item"
                                    href="/settings/">Settings</a></li>\n \n <li>
                                <hr class="dropdown-divider">
                            </li>\n <li><a class="dropdown-item" href="/auth/logout">Logout</a></li>\n </ul>\n </li>\n
                    \n </ul>\n </div>\n </div>\n</nav>
    \n\n<!-- Secondary Navigation Bar (Hidden on smaller screens) -->\n<nav
        class="navbar navbar-light bg-light border-bottom mb-4 d-none d-lg-block">\n <div class="container">\n <ul
                class="navbar-nav flex-row flex-wrap justify-content-center">\n \n \n <li class="nav-item">\n <a
                        class="nav-link px-2 active" href="/diary/">Food Diary</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/my_foods/">My Foods</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/my_meals">My Meals</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/recipes/">My Recipes</a>\n </li>\n <li class="nav-item">\n <a
                        class="nav-link px-2 " href="/search/?search_mode=usda_only">Search USDA</a>\n </li>\n \n\n \n
                \n\n \n \n </ul>\n </div>\n</nav>\n\n <div class="container">\n \n \n \n \n<div class="container">\n \n
            <div class="d-sm-flex justify-content-between align-items-center mb-3 mt-4">\n <div
                    class="d-flex justify-content-between mb-2 mb-sm-0">\n \n <a href="/diary/2025-07-31"
                        class="btn btn-outline-secondary me-2">&laquo; Prev Day</a>\n \n \n <a href="/diary/2025-08-02"
                        class="btn btn-outline-secondary">Next Day &raquo;</a>\n \n </div>\n <h1
                    class="mb-0 text-center">Food Diary</h1>\n <h2 class="mb-0 text-center h4">Friday, August 01, 2025
                </h2>\n</div>\n\n <div class="card mb-4">\n <div class="card-header">\n <h3>Daily Nutrition Summary</h3>
                    \n </div>\n <div class="card-body">\n <div class="row">\n <div class="col-lg-12">\n <h5
                                class="mb-1">Calories Progress</h5>\n <small class="text-muted d-block mb-1">\n Goal:
                                2000.0 kcal | Consumed: 0.0 kcal | Burned: 0.0 kcal\n </small>\n <p class="mb-2">\n
                                Remaining: 2000.0 kcal\n </p>\n <div class="progress" style="height: 15px;">\n \n\n \n\n
                                <div class="progress-bar bg-success" role="progressbar" style="width: 0.0%;"
                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="2000">\n\n 0.0%\n\n </div>\n
                            </div>\n </div>\n </div>\n <div class="row mt-3">\n \n \n <div class="col-lg-4 mb-3">\n <h5
                                class="mb-1">Protein Progress</h5>\n <small class="text-muted d-block mb-1">\n Goal:
                                150.0g | Consumed: 0.0g\n </small>\n <div class="progress" style="height: 15px;">\n \n
                                <div class="progress-bar bg-success" role="progressbar" style="width: 0.0%;"
                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="150">\n 0.0%\n </div>\n </div>\n
                        </div>\n \n <div class="col-lg-4 mb-3">\n <h5 class="mb-1">Carbohydrates Progress</h5>\n <small
                                class="text-muted d-block mb-1">\n Goal: 250.0g | Consumed: 0.0g\n </small>\n <div
                                class="progress" style="height: 15px;">\n \n <div class="progress-bar bg-success"
                                    role="progressbar" style="width: 0.0%;" aria-valuenow="0" aria-valuemin="0"
                                    aria-valuemax="250">\n 0.0%\n </div>\n </div>\n </div>\n \n <div
                            class="col-lg-4 mb-3">\n <h5 class="mb-1">Fat Progress</h5>\n <small
                                class="text-muted d-block mb-1">\n Goal: 60.0g | Consumed: 0.0g\n </small>\n <div
                                class="progress" style="height: 15px;">\n \n <div class="progress-bar bg-success"
                                    role="progressbar" style="width: 0.0%;" aria-valuenow="0" aria-valuemin="0"
                                    aria-valuemax="60">\n 0.0%\n </div>\n </div>\n </div>\n \n </div>\n </div>\n \n \n
                \n <div class="card mb-3">\n <div
                        class="card-header d-flex flex-column flex-md-row justify-content-md-between align-items-md-center">
                        \n <h4 class="mb-2 mb-md-0">\n Breakfast\n \n </h4>\n \n <div
                            class="d-flex flex-column flex-md-row align-items-md-center">\n \n <form
                                action="/diary/save_meal" method="post" class="d-flex me-md-2 mb-2 mb-md-0">\n <input
                                    type="hidden" name="log_date" value="2025-08-01">\n <input type="hidden"
                                    name="meal_name" value="Breakfast">\n <input type="text" name="new_meal_name"
                                    class="form-control form-control-sm me-2" placeholder="Save as new meal...">\n
                                <button type="submit" class="btn btn-outline-success btn-sm">Save</button>\n </form>\n
                            <div class="d-flex">\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Breakfast"
                                    class="btn btn-outline-primary btn-sm">\n <span class="d-none d-md-inline">Add
                                        Food</span>\n <span class="d-inline d-md-none">Add</span>\n </a>\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Breakfast&amp;scan=true"
                                    class="btn btn-outline-info btn-sm ms-2">\n <span class="d-none d-md-inline">Scan
                                        Barcode</span>\n <span class="d-inline d-md-none">Scan</span>\n </a>\n </div>\n
                            \n </div>\n \n </div>\n <ul class="list-group list-group-flush">\n \n <li
                            class="list-group-item">No items logged for this meal.</li>\n \n </ul>\n </div>\n \n \n <div
                    class="card mb-3">\n <div
                        class="card-header d-flex flex-column flex-md-row justify-content-md-between align-items-md-center">
                        \n <h4 class="mb-2 mb-md-0">\n Lunch\n \n </h4>\n \n <div
                            class="d-flex flex-column flex-md-row align-items-md-center">\n \n <form
                                action="/diary/save_meal" method="post" class="d-flex me-md-2 mb-2 mb-md-0">\n <input
                                    type="hidden" name="log_date" value="2025-08-01">\n <input type="hidden"
                                    name="meal_name" value="Lunch">\n <input type="text" name="new_meal_name"
                                    class="form-control form-control-sm me-2" placeholder="Save as new meal...">\n
                                <button type="submit" class="btn btn-outline-success btn-sm">Save</button>\n </form>\n
                            <div class="d-flex">\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Lunch"
                                    class="btn btn-outline-primary btn-sm">\n <span class="d-none d-md-inline">Add
                                        Food</span>\n <span class="d-inline d-md-none">Add</span>\n </a>\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Lunch&amp;scan=true"
                                    class="btn btn-outline-info btn-sm ms-2">\n <span class="d-none d-md-inline">Scan
                                        Barcode</span>\n <span class="d-inline d-md-none">Scan</span>\n </a>\n </div>\n
                            \n </div>\n \n </div>\n <ul class="list-group list-group-flush">\n \n <li
                            class="list-group-item">No items logged for this meal.</li>\n \n </ul>\n </div>\n \n \n <div
                    class="card mb-3">\n <div
                        class="card-header d-flex flex-column flex-md-row justify-content-md-between align-items-md-center">
                        \n <h4 class="mb-2 mb-md-0">\n Dinner\n \n </h4>\n \n <div
                            class="d-flex flex-column flex-md-row align-items-md-center">\n \n <form
                                action="/diary/save_meal" method="post" class="d-flex me-md-2 mb-2 mb-md-0">\n <input
                                    type="hidden" name="log_date" value="2025-08-01">\n <input type="hidden"
                                    name="meal_name" value="Dinner">\n <input type="text" name="new_meal_name"
                                    class="form-control form-control-sm me-2" placeholder="Save as new meal...">\n
                                <button type="submit" class="btn btn-outline-success btn-sm">Save</button>\n </form>\n
                            <div class="d-flex">\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Dinner"
                                    class="btn btn-outline-primary btn-sm">\n <span class="d-none d-md-inline">Add
                                        Food</span>\n <span class="d-inline d-md-none">Add</span>\n </a>\n <a
                                    href="/search/?target=diary&amp;log_date=2025-08-01&amp;meal_name=Dinner&amp;scan=true"
                                    class="btn btn-outline-info btn-sm ms-2">\n <span class="d-none d-md-inline">Scan
                                        Barcode</span>\n <span class="d-inline d-md-none">Scan</span>\n </a>\n </div>\n
                            \n </div>\n \n </div>\n <ul class="list-group list-group-flush">\n \n <li
                            class="list-group-item">No items logged for this meal.</li>\n \n </ul>\n </div>\n \n</div>
            \n\n </div>\n\n <!-- Add to Diary Modal -->\n <div class="modal fade" id="addToDiaryModal" tabindex="-1"
            aria-labelledby="addToDiaryModalLabel" aria-hidden="true">\n <div class="modal-dialog">\n <div
                    class="modal-content">\n <div class="modal-header">\n <h5 class="modal-title"
                            id="addToDiaryModalLabel">Add to Diary</h5>\n <button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button>\n </div>\n <form id="addToDiaryForm"
                        action="/search/add_item" method="post">\n <div class="modal-body">\n <p>Adding: <strong
                                    id="modalFoodName"></strong></p>\n <input type="hidden" name="food_id"
                                id="modalFoodId">\n <input type="hidden" name="food_type" id="modalFoodType">\n <input
                                type="hidden" name="target" value="diary">\n\n <div class="mb-3">\n <label
                                    for="modalLogDate" class="form-label">Date</label>\n <input type="date"
                                    class="form-control" id="modalLogDate" name="log_date" required>\n </div>\n\n <div
                                class="mb-3">\n <label for="modalMealName" class="form-label">Meal</label>\n <select
                                    class="form-select" id="modalMealName" name="meal_name" required>\n
                                    <!-- Options will be populated by JavaScript -->\n </select>\n </div>\n\n <div
                                id="modalAmountPortionFields">\n <div class="row">\n <div class="col">\n <div
                                            class="mb-3">\n <label for="modalAmount"
                                                class="form-label">Quantity</label>\n <input type="number" step="0.01"
                                                class="form-control" id="modalAmount" name="amount" value="1"
                                                required>\n </div>\n </div>\n <div class="col">\n <div class="mb-3">\n
                                            <label for="modalPortionId" class="form-label">Portion</label>\n <select
                                                class="form-select" id="modalPortionId" name="portion_id" required>\n
                                                <!-- Options will be populated by JavaScript -->\n </select>\n </div>\n
                                    </div>\n </div>\n </div>\n\n </div>\n <div class="modal-footer">\n <button
                                type="button" class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">Cancel</button>\n <button type="submit"
                                class="btn btn-outline-primary">Confirm Add</button>\n </div>\n </form>\n </div>\n
            </div>\n </div>\n\n
        <script src="/static/bootstrap.bundle.min.js"></script>\n \n
        <script>\n        document.addEventListener(\'DOMContentLoaded\', function() {\n            const addToDiaryModal = new bootstrap.Modal(document.getElementById(\'addToDiaryModal\'));\n            const addToDiaryForm = document.getElementById(\'addToDiaryForm\');\n            const modalFoodName = document.getElementById(\'modalFoodName\');\n            const modalFoodId = document.getElementById(\'modalFoodId\');\n            const modalFoodType = document.getElementById(\'modalFoodType\');\n            const modalLogDate = document.getElementById(\'modalLogDate\');\n            const modalMealName = document.getElementById(\'modalMealName\');\n            const modalPortionId = document.getElementById(\'modalPortionId\');\n            const modalAmountPortionFields = document.getElementById(\'modalAmountPortionFields\');\n\n            document.querySelectorAll(\'.add-to-diary-btn\').forEach(button => {\n                button.addEventListener(\'click\', function() {\n                    const foodId = this.dataset.foodId;\n                    const foodType = this.dataset.foodType;\n                    const foodName = this.dataset.foodName;\n\n                    // 1. Populate static fields\n                    modalFoodName.textContent = foodName;\n                    modalFoodId.value = foodId;\n                    modalFoodType.value = foodType;\n\n                    // 2. Set date to today\n                    modalLogDate.value = new Date().toISOString().split(\'T\')[0];\n\n                    // 3. Build meal dropdown\n                    modalMealName.innerHTML = \'\';\n                    const mealsPerDay = 3;\n                    const standardMealNames = ["Breakfast", "Snack (morning)", "Lunch", "Snack (afternoon)", "Dinner", "Snack (evening)"];\n                    for (let i = 0; i < mealsPerDay; i++) {\n                        const option = document.createElement(\'option\');\n                        option.value = standardMealNames[i];\n                        option.textContent = standardMealNames[i];\n                        modalMealName.appendChild(option);\n                    }\n\n                    // 4. Show/hide amount/portion fields based on food type\n                    if (foodType === \'my_meal\') {\n                        modalAmountPortionFields.style.display = \'none\';\n                    } else {\n                        modalAmountPortionFields.style.display = \'block\';\n                    }\n\n                    // 5. Fetch portions\n                    modalPortionId.innerHTML = \'<option>Loading...</option>\';\n                    fetch(`/search/api/get-portions/${foodType}/${foodId}`)\n                        .then(response => response.json())\n                        .then(data => {\n                            modalPortionId.innerHTML = \'\';\n                            if (data.error) {\n                                const option = document.createElement(\'option\');\n                                option.textContent = \'Error loading portions\';\n                                modalPortionId.appendChild(option);\n                                console.error(\'Error fetching portions:\', data.error);\n                                return;\n                            }\n                            data.forEach(portion => {\n                                const option = document.createElement(\'option\');\n                                option.value = portion.id;\n                                option.textContent = portion.description;\n                                modalPortionId.appendChild(option);\n                            });\n                        })\n                        .catch(error => {\n                            modalPortionId.innerHTML = \'\';\n                            const option = document.createElement(\'option\');\n                            option.textContent = \'Error loading portions\';\n                            modalPortionId.appendChild(option);\n                            console.error(\'Error fetching portions:\', error);\n                        });\n\n                    // 6. Show modal\n                    addToDiaryModal.show();\n                });\n            });\n\n            // Handle form submission with Fetch API to stay on the same page\n            addToDiaryForm.addEventListener(\'submit\', function(event) {\n                event.preventDefault(); // Stop default form submission\n\n                const formData = new FormData(this);\n                \n                fetch(this.action, {\n                    method: \'POST\',\n                    body: formData\n                })\n                .then(response => {\n                    // Check for redirect, which indicates success in the add_item endpoint\n                    if (response.redirected) {\n                        // Manually follow the redirect to get the flash messages\n                        return fetch(response.url);\n                    }\n                    // If no redirect, something might have gone wrong, or it was an API response\n                    return response.text();\n                })\n                .then(html => {\n                    // The response from the followed redirect will contain the new page with the flash message.\n                    // We can just reload the current page, and the flash message from the server session will be displayed.\n                    window.location.reload();\n                })\n                .catch(error => {\n                    console.error(\'Error submitting form:\', error);\n                    // Optionally, display an error message in the modal\n                });\n\n                addToDiaryModal.hide();\n            });\n\n            const htmlTag = document.documentElement;\n            const userThemePreference = htmlTag.getAttribute(\'data-bs-theme\');\n\n            if (userThemePreference === \'auto\') {\n                const prefersDarkMode = window.matchMedia(\'(prefers-color-scheme: dark)\').matches;\n                if (prefersDarkMode) {\n                    htmlTag.setAttribute(\'data-bs-theme\', \'dark\');\n                } else {\n                    htmlTag.setAttribute(\'data-bs-theme\', \'light\');\n                }\n            }\n        });\n    </script>
        \n \n
        <script>\n        document.addEventListener(\'DOMContentLoaded\', function() {\n            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n            if (userTimezone) {\n                fetch("/settings/set-timezone", {\n                    method: \'POST\',\n                    headers: {\n                        \'Content-Type\': \'application/json\',\n                    },\n                    body: JSON.stringify({ timezone: userTimezone }),\n                })\n                .then(response => response.json())\n                .then(data => {\n                    if (data.status === \'success\') {\n                        console.log(\'Timezone set to:\', userTimezone);\n                        // Optionally, reload the page to apply the new timezone immediately\n                        // window.location.reload();\n                    }\n                })\n                .catch((error) => {\n                    console.error(\'Error setting timezone:\', error);\n                });\n            }\n        });\n    </script>
        \n \n </body>\n

</html>