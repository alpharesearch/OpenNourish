{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Settings Form Column -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h4>User Settings</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('settings.settings') }}">
                        {{ settings_form.hidden_tag() }}

                        <!-- Measurement System -->
                        <div class="mb-3">
                            {{ settings_form.measurement_system.label(class="form-label") }}
                            <div>
                                {% for subfield in settings_form.measurement_system %}
                                <div class="form-check form-check-inline">
                                    {{ subfield(class="form-check-input") }}
                                    {{ subfield.label(class="form-check-label") }}
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Age and Gender -->
                        <div class="row">
                            <div class="col-lg-6 mb-3">
                                {{ settings_form.age.label(class="form-label") }}
                                {{ settings_form.age(class="form-control") }}
                            </div>
                            <div class="col-lg-6 mb-3">
                                {{ settings_form.gender.label(class="form-label") }}
                                {{ settings_form.gender(class="form-control") }}
                            </div>
                        </div>

                        <!-- Height Fields -->
                        <div id="height-metric" class="mb-3">
                            {{ settings_form.height_cm.label(class="form-label") }}
                            {{ settings_form.height_cm(class="form-control") }}
                        </div>
                        <div id="height-us" class="row">
                            <div class="col-lg-6 mb-3">
                                {{ settings_form.height_ft.label(class="form-label") }}
                                {{ settings_form.height_ft(class="form-control") }}
                            </div>
                            <div class="col-lg-6 mb-3">
                                {{ settings_form.height_in.label(class="form-label") }}
                                {{ settings_form.height_in(class="form-control") }}
                            </div>
                        </div>
                        
                        <!-- Navbar Preference -->
                        <div class="mb-3">
                            {{ settings_form.navbar_preference.label(class="form-label") }}
                            {{ settings_form.navbar_preference(class="form-select") }}
                        </div>

                        <!-- Diary Default View -->
                        <div class="mb-3">
                            {{ settings_form.diary_default_view.label(class="form-label") }}
                            {{ settings_form.diary_default_view(class="form-select") }}
                        </div>

                        <!-- Theme Preference -->
                        <div class="mb-3">
                            {{ settings_form.theme_preference.label(class="form-label") }}
                            {{ settings_form.theme_preference(class="form-select") }}
                        </div>
                        
                        <button type="submit" name="submit_settings" class="btn btn-outline-primary">Save Settings</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Change Password Form Column -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h4>Change Password</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('settings.settings') }}">
                        {{ password_form.hidden_tag() }}
                        <div class="mb-3">
                            {{ password_form.password.label(class="form-label") }}
                            {{ password_form.password(class="form-control") }}
                        </div>
                        <div class="mb-3">
                            {{ password_form.password2.label(class="form-label") }}
                            {{ password_form.password2(class="form-control") }}
                        </div>
                        <button type="submit" name="submit_password" class="btn btn-outline-success">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const measurementSystemRadios = document.querySelectorAll('input[name="measurement_system"]');
    const heightMetricDiv = document.getElementById('height-metric');
    const heightUsDiv = document.getElementById('height-us');

    function toggleHeightFields() {
        const selectedSystem = document.querySelector('input[name="measurement_system"]:checked').value;
        if (selectedSystem === 'metric') {
            heightMetricDiv.style.display = 'block';
            heightUsDiv.style.display = 'none';
        } else {
            heightMetricDiv.style.display = 'none';
            heightUsDiv.style.display = 'flex'; // Use flex for row layout
        }
    }

    measurementSystemRadios.forEach(radio => {
        radio.addEventListener('change', toggleHeightFields);
    });

    // Initial check
    toggleHeightFields();
});
</script>
{% endblock %}
