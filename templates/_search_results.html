{% if search_results %}
    <h3>USDA Foods</h3>
    <div class="list-group mb-4">
        {% for food in search_results if food.type == 'usda' %}
            <div class="list-group-item">
                {% if request.endpoint == 'recipes.edit_recipe' %}
                    <form method="POST" action="{{ url_for('recipes.add_ingredient', recipe_id=recipe.id) }}" class="d-flex justify-content-between align-items-center">
                        <input type="hidden" name="food_id" value="{{ food.fdc_id }}">
                        <input type="hidden" name="food_type" value="{{ food.type }}">
                        <span>{{ food.description }}</span>
                        <div class="input-group" style="width: 200px;">
                            <input type="number" step="0.01" name="amount" class="form-control" placeholder="Grams" required>
                            <button type="submit" class="btn btn-primary">Add</button>
                        </div>
                    </form>
                {% elif request.endpoint == 'diary.search_for_diary' or request.endpoint == 'diary.search_for_meal_item' %}
                    <form action="{% if log_date %}{{ url_for('diary.add_entry') }}{% elif meal %}{{ url_for('diary.add_meal_item', meal_id=meal.id) }}{% endif %}" method="post" class="d-flex justify-content-between align-items-center">
                        {{ food.description }}
                        <div class="d-flex">
                            {% if log_date %}
                            <input type="hidden" name="log_date" value="{{ log_date.isoformat() }}">
                            <input type="hidden" name="meal_name" value="{{ meal_name }}">
                            {% elif meal %}
                            <input type="hidden" name="meal_id" value="{{ meal.id }}">
                            {% endif %}
                            <input type="hidden" name="fdc_id" value="{{ food.fdc_id }}">
                            <input type="number" name="amount" class="form-control me-2" placeholder="grams" required>
                            <button type="submit" class="btn btn-success btn-sm">Add</button>
                        </div>
                    </form>
                {% endif %}
            </div>
        {% else %}
            <div class="list-group-item">No USDA foods found.</div>
        {% endfor %}
    </div>

    <h3>My Foods</h3>
    <div class="list-group mb-4">
        {% for food in search_results if food.type == 'my_food' %}
            <div class="list-group-item">
                {% if request.endpoint == 'recipes.edit_recipe' %}
                    <form method="POST" action="{{ url_for('recipes.add_ingredient', recipe_id=recipe.id) }}" class="d-flex justify-content-between align-items-center">
                        <input type="hidden" name="food_id" value="{{ food.id }}">
                        <input type="hidden" name="food_type" value="{{ food.type }}">
                        <span>{{ food.description }}</span>
                        <div class="input-group" style="width: 200px;">
                            <input type="number" step="0.01" name="amount" class="form-control" placeholder="Grams" required>
                            <button type="submit" class="btn btn-primary">Add</button>
                        </div>
                    </form>
                {% elif request.endpoint == 'diary.search_for_diary' or request.endpoint == 'diary.search_for_meal_item' %}
                    <form action="{% if log_date %}{{ url_for('diary.add_entry') }}{% elif meal %}{{ url_for('diary.add_meal_item', meal_id=meal.id) }}{% endif %}" method="post" class="d-flex justify-content-between align-items-center">
                        {{ food.description }}
                        <div class="d-flex">
                            {% if log_date %}
                            <input type="hidden" name="log_date" value="{{ log_date.isoformat() }}">
                            <input type="hidden" name="meal_name" value="{{ meal_name }}">
                            {% elif meal %}
                            <input type="hidden" name="meal_id" value="{{ meal.id }}">
                            {% endif %}
                            <input type="hidden" name="my_food_id" value="{{ food.id }}">
                            <input type="number" name="amount" class="form-control me-2" placeholder="grams" required>
                            <button type="submit" class="btn btn-success btn-sm">Add</button>
                        </div>
                    </form>
                {% endif %}
            </div>
        {% else %}
            <div class="list-group-item">No custom foods found.</div>
        {% endfor %}
    </div>

    <h3>My Meals</h3>
    <div class="list-group mb-4">
        {% for searched_meal in search_results if searched_meal.type == 'my_meal' %}
            <div class="list-group-item">
                {% if request.endpoint == 'recipes.edit_recipe' %}
                    <form method="POST" action="{{ url_for('recipes.add_ingredient', recipe_id=recipe.id) }}" class="d-flex justify-content-between align-items-center">
                        <input type="hidden" name="meal_id" value="{{ meal.id }}">
                        <input type="hidden" name="food_type" value="{{ meal.type }}"> {# This will be 'my_meal' #}
                        <span>{{ meal.name }}</span>
                        <button type="submit" class="btn btn-primary">Add All Foods from Meal</button>
                    </form>
                {% elif request.endpoint == 'diary.search_for_diary' or request.endpoint == 'diary.search_for_meal_item' %}
                    <form action="{{ url_for('diary.add_meal_item', meal_id=meal.id) }}" method="post" class="d-flex justify-content-between align-items-center">
                        {{ searched_meal.name }}
                        <div class="d-flex">
                            <input type="hidden" name="source_meal_id" value="{{ searched_meal.id }}">
                            <button type="submit" class="btn btn-success btn-sm">Add</button>
                        </div>
                    </form>
                {% endif %}
            </div>
        {% else %}
            <div class="list-group-item">No meals found.</div>
        {% endfor %}
    </div>
{% endif %}
