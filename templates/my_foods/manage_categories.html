{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <!-- PAGE HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Manage Categories</h1>
        <a href="{{ url_for('my_foods.my_foods') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-return-left"></i> Back to My Foods
        </a>
    </div>

    <!-- ADD NEW CATEGORY CARD -->
    <div class="card mb-4">
        <div class="card-header">
            <h2 class="h5 mb-0">Add New Category</h2>
        </div>
        <div class="card-body">
            <form action="{{ url_for('my_foods.manage_categories') }}" method="POST" class="row g-3 align-items-center">
                {{ form.hidden_tag() }}
                <div class="col-auto flex-grow-1">
                    {{ form.description(class="form-control", placeholder="Enter new category name") }}
                </div>
                <div class="col-auto">
                    {{ form.submit(class="btn btn-primary") }}
                </div>
            </form>
        </div>
    </div>

    <!-- EXISTING CATEGORIES CARD -->
    <div class="card">
        <div class="card-header">
            <h2 class="h5 mb-0">Your Categories</h2>
        </div>
        <div class="list-group list-group-flush">
            {% if categories %}
                {% for category in categories %}
                <div class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="flex-grow-1 me-3" id="view-{{ category.id }}">
                            {{ category.description }}
                        </div>
                        <div class="flex-grow-1 me-3 d-none" id="edit-{{ category.id }}">
                            <form action="{{ url_for('my_foods.edit_category', category_id=category.id) }}" method="POST" class="d-flex">
                                <input type="text" name="description" class="form-control me-2" value="{{ category.description }}">
                                <button type="submit" class="btn btn-success btn-sm me-2"><i class="bi bi-check2-circle"></i></button>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="toggleEditView({{ category.id }})"><i class="bi bi-x-circle"></i></button>
                            </form>
                        </div>
                        <div>
                            <button class="btn btn-outline-primary btn-sm me-2" onclick="toggleEditView({{ category.id }})"><i class="bi bi-pencil-square"></i></button>
                            <form action="{{ url_for('my_foods.delete_category', category_id=category.id) }}" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-outline-danger btn-sm"><i class="bi bi-x-circle"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="list-group-item text-center text-muted">
                    You haven't created any categories yet.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleEditView(categoryId) {
    const viewDiv = document.getElementById('view-' + categoryId);
    const editDiv = document.getElementById('edit-' + categoryId);
    viewDiv.classList.toggle('d-none');
    editDiv.classList.toggle('d-none');
}
</script>
{% endblock %}