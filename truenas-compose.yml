# Build both services defined in the compose file
#docker compose build

# Tag both images for your private registry
#docker tag opennourish-opennourish-app:latest saturn.ms4f.net:30095/opennourish-app:latest
#docker tag opennourish-nginx:latest saturn.ms4f.net:30095/opennourish-nginx:latest

# Push both images
#docker push saturn.ms4f.net:30095/opennourish-app:latest
#docker push saturn.ms4f.net:30095/opennourish-nginx:latest

#use this part in TrueNAS:
services:
  opennourish-app:
    image: saturn.ms4f.net:30095/opennourish-app:latest
    restart: unless-stopped
    environment:
      - SECRET_KEY=YourSuperStrongSecretKeyGoesHere
      - SEED_DEV_DATA=true
    volumes:
      - /mnt/data-pool/opennourish:/app/persistent

  nginx:
    image: saturn.ms4f.net:30095/opennourish-nginx:latest
    restart: unless-stopped
    ports:
      - "18080:80"
      - "18443:443"
    volumes:
      # Nginx still needs access to the persistent data to get the SSL certificates
      - /mnt/data-pool/opennourish:/data:ro
    depends_on:
      - opennourish-app